

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>13. Misfit and Adjoint Source Calculation &mdash; LASIF 0.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="LASIF 0.0.1 documentation" href="../index.html"/>
        <link rel="up" title="Tutorial" href="../tutorial.html"/>
        <link rel="next" title="14. Model Update" href="13_model_update.html"/>
        <link rel="prev" title="12. Synthetics" href="11_synthetic_waveforms.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> LASIF</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../prerequisites.html">Installation, Testing &amp; DevInfo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../prerequisites.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prerequisites.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../prerequisites.html#developer-information">Developer Information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction.html#further-information">Further Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction.html#to-do-things-that-are-still-missing">TO DO: Things that are still missing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction.html#supported-data-formats">Supported Data Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction.html#further-notes">Further Notes</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="00_interfaces.html">1. Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_creating_a_new_project.html">2. Creating a New Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_seismic_events.html">3. Seismic Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_station_data.html">4. Station Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_waveform_data.html">5. Waveform Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_download_helpers.html">6. Download Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_data_inspection.html">7. Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_data_validation.html">8. Data Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_a_new_iteration.html">9. Defining a New Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="09_model_handling.html">10. Earth Model Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_generating_input_files.html">11. Generating SES3D Input Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_synthetic_waveforms.html">12. Synthetics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">13. Misfit and Adjoint Source Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_model_update.html">14. Model Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_next_iterations.html">15. Next Iterations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cli.html#data-acquisition-functions">Data Acquisition Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html#event-management-functions">Event Management Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html#iteration-management-functions">Iteration Management Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html#misc-functions">Misc Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html#plotting-functions">Plotting Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cli.html#project-management-functions">Project Management Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../webinterface.html">Web Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../rotations.html">lasif.rotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../iris2quakeml.html">lasif.scripts.iris2quakeml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools.html">lasif.tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools.parallel.html">lasif.tools.parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools.file_info_cache.html">lasif.tools.file_info_cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/components.html">API Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_lasif_finds_coordinates.html">How LASIF Finds Coordinates</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">LASIF</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../tutorial.html">Tutorial</a> &raquo;</li>
      
    <li>13. Misfit and Adjoint Source Calculation</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/tutorial/12_misfits_and_adjoint_sources.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="misfit-and-adjoint-source-calculation">
<h1>13. Misfit and Adjoint Source Calculation<a class="headerlink" href="#misfit-and-adjoint-source-calculation" title="Permalink to this headline">¶</a></h1>
<p>In order to simulate the adjoint wavefield one needs to calculate the adjoint
sources. An adjoint source is usually dependent on the misfit between the
synthetics and real data.</p>
<p>LASIF currently supports misfits in the time-frequency domain as defined by
Fichtner, 2008. Great care has to be taken to avoid cycle skips/phase jumps
between synthetics and data. This is achieved by careful windowing.</p>
<div class="section" id="weighting-scheme">
<h2>13.1. Weighting Scheme<a class="headerlink" href="#weighting-scheme" title="Permalink to this headline">¶</a></h2>
<p>You might have noticed that at various points it has been possible to
distribute weights. These weights all contribute to the final adjoint source.
The inversion scheme requires one adjoint source per iteration, event, station,
and component.</p>
<p>In each iteration&#8217;s XML file you can specify the weight for each event, denoted
as <span class="math">\(w_{event}\)</span> in the following. The weight is allowed to range between
0.0 and 1.0. A weight of 0.0 corresponds to no weight at all, e.g. skip the
event and a weight of 1.0 is the maximum weight.</p>
<p>Within each event is possible to weight each station separately, in the
following named <span class="math">\(w_{station}\)</span>. The station weights can also range from
0.0 to 1.0 and follow the same logic as the event weights.</p>
<p>You can furthermore choose an arbitrary number of windows per component for
which the misfit and adjoint source will be calculated. Each window has a
separate weight with the only limitation being that the weight has to be
positive. Assuming <span class="math">\(N\)</span> windows in a given component, the corresponding
adjoint sources will be called <span class="math">\(ad\_src_{1..N}\)</span> while their weights are
<span class="math">\(w_{1..N}\)</span>.</p>
<p>The final adjoint source for every component will be calculated according to
the following formula:</p>
<div class="math">
\[adj\_source = w_{event} \cdot w_{station} \cdot \frac{1}{\sum_{i=1}^N w_i} \cdot \sum_{i=1}^N w_i \cdot ad\_src_i\]</div>
</div>
<div class="section" id="misfit-gui">
<h2>13.2. Misfit GUI<a class="headerlink" href="#misfit-gui" title="Permalink to this headline">¶</a></h2>
<p>LASIF comes with a graphical utility dubbed the Misfit GUI, that helps to pick
correct windows.</p>
<p>To launch it, execute the <strong>launch_misfit_gui</strong> together with the iteration
name and the event name.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>lasif launch_misfit_gui 1 GCMT_event_NORTHERN_ITALY_Mag_4.9_2000-8-21-17
</pre></div>
</div>
<p>This will open a window akin to the following:</p>
<a class="reference internal image-reference" href="../_images/misfit_gui.png"><img alt="../_images/misfit_gui.png" class="align-center" src="../_images/misfit_gui.png" style="width: 90%;" /></a>
<p>It is essentially partitioned into three parts. The top part is devoted to plot
all three traces of a single station. The bottom left part shows a
representation of the misfit for the last chosen window and the bottom left
part shows a simple map.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The current interface is based purely on matplotlib. This has the advantage
of keeping dependencies to minimum. Unfortunately matplotlib is not a GUI
toolkit and therefore the GUI is not particularly pleasing from a UI/UX
point of view. Some operations might feel clunky. We might move to a proper
GUI toolkit in the future.</p>
</div>
<p>With the <strong>Next</strong> and <strong>Prev</strong> button you can jump from one station to the
next. The <strong>Reset Station</strong> button will remove all windows for the current
station.</p>
<p>The weight for any window has to be chosen before the windows are picked. To
chose the current weight, press the <strong>w</strong> key. At this point, the weight box
will be red. Now simply type the desired new weight and press <strong>Enter</strong> to
finish setting the new weight. All windows chosen from this point on will
be assigned this weight.</p>
<p>To actually choose a window simply drag in any of the waveform windows. Upon
mouse button release the window will be saved and the adjoint source will be
calculated. The number in the top left of each chosen window reflects the
weight for that window.</p>
<p>Right clicking on an already existing window will delete it, left clicking will
plot the misfit once again.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At any point you can press <strong>h</strong> to get an up-to-date help text for the
GUI.</p>
</div>
</div>
<div class="section" id="final-adjoint-source-calculation">
<h2>13.3. Final Adjoint Source Calculation<a class="headerlink" href="#final-adjoint-source-calculation" title="Permalink to this headline">¶</a></h2>
<p>During window selection the adjoint source for each chosen window will be
stored separately. To combine them to, apply the weighting scheme and convert
them to a format, that SES3D can actually use, run the
<strong>finalize_adjoint_sources</strong> command with the iteration name and the event
name.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>lasif finalize_adjoint_sources 1 GCMT_event_NORTHERN_ITALY_Mag_4.9_2000-8-21-17
</pre></div>
</div>
<p>This will also rotate the adjoint sources to the frame of reference used in the
simulations.</p>
<p>If you pick any more windows or change them in any way, you need to run the
command again. The result of that command is a list of adjoint sources
directly usable by SES3D in the <tt class="docutils literal"><span class="pre">OUTPUT</span></tt> folder.</p>
<p>Copy these to the correct folder inside your SES3D installation,
make sure the tell SES3D to perform an adjoint reverse simulation and launch
it. Please refer to the SES3D manual for the necessary details.</p>
<p>Now do the same for the second event.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="13_model_update.html" class="btn btn-neutral float-right" title="14. Model Update">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="11_synthetic_waveforms.html" class="btn btn-neutral" title="12. Synthetics"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Lion Krischer &amp; Andreas Fichtner.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>