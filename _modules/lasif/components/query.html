

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lasif.components.query &mdash; LASIF 0.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="LASIF 0.0.1 documentation" href="../../../index.html"/>
        <link rel="up" title="lasif" href="../../lasif.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../../../index.html" class="icon icon-home"> LASIF
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../prerequisites.html">Installation, Testing &amp; DevInfo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../prerequisites.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../prerequisites.html#testing">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../prerequisites.html#building-the-documentation">Building the Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../prerequisites.html#developer-information">Developer Information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#further-information">Further Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#to-do-things-that-are-still-missing">TO DO: Things that are still missing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#supported-data-formats">Supported Data Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.html#further-notes">Further Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/00_interfaces.html">1. Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/01_creating_a_new_project.html">2. Creating a New Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/02_seismic_events.html">3. Seismic Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/03_station_data.html">4. Station Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/04_waveform_data.html">5. Waveform Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/05_download_helpers.html">6. Download Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/06_data_inspection.html">7. Data Inspection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/07_data_validation.html">8. Data Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/08_a_new_iteration.html">9. Defining a New Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/09_model_handling.html">10. Earth Model Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/10_generating_input_files.html">11. Generating SES3D Input Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/11_synthetic_waveforms.html">12. Synthetics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/12_misfits_and_adjoint_sources.html">13. Misfit and Adjoint Source Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/13_model_update.html">14. Model Update</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/14_next_iterations.html">15. Next Iterations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorial/15_customizing_lasif.html">16. Customizing LASIF</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command Line Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cli.html#mpi">MPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cli.html#command-documentation">Command Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../webinterface.html">Web Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api_doc.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../iris2quakeml.html">lasif.scripts.iris2quakeml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ses3d_setup_helper.html">SES3D Setup Assistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../iteration_xml.html">lasif.iteration_xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rotations.html">lasif.rotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../window_selection.html">lasif.window_selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.html">lasif.tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.parallel.html">lasif.tools.parallel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools.file_info_cache.html">lasif.tools.file_info_cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../components/components.html">API Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../how_lasif_finds_coordinates.html">How LASIF Finds Coordinates</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">LASIF</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../lasif.html">lasif</a> &raquo;</li>
      
    <li>lasif.components.query</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for lasif.components.query</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">lasif</span> <span class="kn">import</span> <span class="n">LASIFError</span><span class="p">,</span> <span class="n">LASIFNotFoundError</span><span class="p">,</span> <span class="n">LASIFWarning</span>

<span class="kn">from</span> <span class="nn">.component</span> <span class="kn">import</span> <span class="n">Component</span>

<span class="n">DataTuple</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;DataTuple&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="s">&quot;synthetics&quot;</span><span class="p">,</span>
                                                 <span class="s">&quot;coordinates&quot;</span><span class="p">])</span>


<div class="viewcode-block" id="QueryComponent"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent">[docs]</a><span class="k">class</span> <span class="nc">QueryComponent</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This component is responsible for making queries across the different</span>
<span class="sd">    components and integrating them in a meaningful way.</span>

<span class="sd">    :param communicator: The communicator instance.</span>
<span class="sd">    :param component_name: The name of this component for the communicator.</span>

<span class="sd">    It should thus be initialized fairly late as it needs access to a number</span>
<span class="sd">    of other components via the communicator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="QueryComponent.get_all_stations_for_event"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.get_all_stations_for_event">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_stations_for_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all stations for one event.</span>

<span class="sd">        A station is considered to be available for an event if at least one</span>
<span class="sd">        channel has raw data and an associated station file. Furthermore it</span>
<span class="sd">        must be possible to derive coordinates for the station.</span>

<span class="sd">        :type event_name: str</span>
<span class="sd">        :param event_name: Name of the event.</span>

<span class="sd">        &gt;&gt;&gt; import pprint</span>
<span class="sd">        &gt;&gt;&gt; comm = getfixture(&#39;query_comm&#39;)</span>
<span class="sd">        &gt;&gt;&gt; pprint.pprint(comm.query.get_all_stations_for_event(</span>
<span class="sd">        ...     &quot;GCMT_event_TURKEY_Mag_5.1_2010-3-24-14-11&quot;)) \</span>
<span class="sd">        # doctest: +NORMALIZE_WHITESPACE</span>
<span class="sd">        {u&#39;HL.ARG&#39;: {&#39;elevation_in_m&#39;: 170.0, &#39;latitude&#39;: 36.216,</span>
<span class="sd">                     &#39;local_depth_in_m&#39;: 0.0, &#39;longitude&#39;: 28.126},</span>
<span class="sd">         u&#39;HT.SIGR&#39;: {&#39;elevation_in_m&#39;: 93.0, &#39;latitude&#39;: 39.2114,</span>
<span class="sd">                      &#39;local_depth_in_m&#39;: 0.0, &#39;longitude&#39;: 25.8553},</span>
<span class="sd">         u&#39;KO.KULA&#39;: {&#39;elevation_in_m&#39;: 915.0, &#39;latitude&#39;: 38.5145,</span>
<span class="sd">                      &#39;local_depth_in_m&#39;: 0.0, &#39;longitude&#39;: 28.6607},</span>
<span class="sd">         u&#39;KO.RSDY&#39;: {&#39;elevation_in_m&#39;: 0.0, &#39;latitude&#39;: 40.3972,</span>
<span class="sd">                      &#39;local_depth_in_m&#39;: 0.0, &#39;longitude&#39;: 37.3273}}</span>


<span class="sd">        Raises a :class:`~lasif.LASIFNotFoundError` if the event does not</span>
<span class="sd">        exist.</span>

<span class="sd">        &gt;&gt;&gt; comm.query.get_all_stations_for_event(&quot;RandomEvent&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">            ...</span>
<span class="sd">        LASIFNotFoundError: ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>

        <span class="c"># Collect information from all the different places.</span>
        <span class="n">waveform_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_raw</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>
        <span class="n">station_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">get_all_channels_at_time</span><span class="p">(</span>
            <span class="n">event</span><span class="p">[</span><span class="s">&quot;origin_time&quot;</span><span class="p">])</span>
        <span class="n">inventory_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">inventory_db</span><span class="o">.</span><span class="n">get_all_coordinates</span><span class="p">()</span>

        <span class="n">stations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">waveform</span> <span class="ow">in</span> <span class="n">waveform_metadata</span><span class="p">:</span>
            <span class="n">station_id</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">waveform</span><span class="p">[</span><span class="s">&quot;network&quot;</span><span class="p">],</span> <span class="n">waveform</span><span class="p">[</span><span class="s">&quot;station&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">station_id</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">stat_coords</span> <span class="o">=</span> <span class="n">station_coordinates</span><span class="p">[</span><span class="n">waveform</span><span class="p">[</span><span class="s">&quot;channel_id&quot;</span><span class="p">]]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="c"># No station file for channel.</span>
                <span class="k">continue</span>

            <span class="c"># First attempt to retrieve from the station files.</span>
            <span class="k">if</span> <span class="n">stat_coords</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">stations</span><span class="p">[</span><span class="n">station_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">stat_coords</span>
                <span class="k">continue</span>
            <span class="c"># Then from the waveform metadata in the case of a sac file.</span>
            <span class="k">elif</span> <span class="n">waveform</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">stations</span><span class="p">[</span><span class="n">station_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">waveform</span>
                <span class="k">continue</span>
            <span class="c"># If that still does not work, check if the inventory database</span>
            <span class="c"># has an entry.</span>
            <span class="k">elif</span> <span class="n">station_id</span> <span class="ow">in</span> <span class="n">inventory_coordinates</span><span class="p">:</span>
                <span class="n">coords</span> <span class="o">=</span> <span class="n">inventory_coordinates</span><span class="p">[</span><span class="n">station_id</span><span class="p">]</span>
                <span class="c"># Otherwise already queried for, but no coordinates found.</span>
                <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]:</span>
                    <span class="n">stations</span><span class="p">[</span><span class="n">station_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
                <span class="k">continue</span>

            <span class="c"># The last resort is a new query via the inventory database.</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">inventory_db</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span><span class="n">station_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]:</span>
                <span class="n">stations</span><span class="p">[</span><span class="n">station_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
        <span class="k">return</span> <span class="n">stations</span>
</div>
<div class="viewcode-block" id="QueryComponent.get_coordinates_for_station"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.get_coordinates_for_station">[docs]</a>    <span class="k">def</span> <span class="nf">get_coordinates_for_station</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">station_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the coordinates for one station.</span>

<span class="sd">        Must be in sync with :meth:`~.get_all_stations_for_event`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>

        <span class="c"># Collect information from all the different places.</span>
        <span class="n">waveform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_raw_for_station</span><span class="p">(</span>
            <span class="n">event_name</span><span class="p">,</span> <span class="n">station_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">station_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">get_all_channels_at_time</span><span class="p">(</span>
            <span class="n">event</span><span class="p">[</span><span class="s">&quot;origin_time&quot;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">stat_coords</span> <span class="o">=</span> <span class="n">station_coordinates</span><span class="p">[</span><span class="n">waveform</span><span class="p">[</span><span class="s">&quot;channel_id&quot;</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c"># No station file for channel.</span>
            <span class="k">raise</span> <span class="n">LASIFNotFoundError</span><span class="p">(</span><span class="s">&quot;Station &#39;</span><span class="si">%s</span><span class="s">&#39; has no available &quot;</span>
                                     <span class="s">&quot;station file.&quot;</span> <span class="o">%</span> <span class="n">station_id</span><span class="p">)</span>

        <span class="c"># First attempt to retrieve from the station files.</span>
        <span class="k">if</span> <span class="n">stat_coords</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">stat_coords</span>
        <span class="c"># Then from the waveform metadata in the case of a sac file.</span>
        <span class="k">elif</span> <span class="n">waveform</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">waveform</span>
        <span class="c"># The last resort is a new query via the inventory database.</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">inventory_db</span><span class="o">.</span><span class="n">get_coordinates</span><span class="p">(</span><span class="n">station_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">coords</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">coords</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># No station file for channel.</span>
            <span class="k">raise</span> <span class="n">LASIFNotFoundError</span><span class="p">(</span><span class="s">&quot;Coordinates could not be deduced for &quot;</span>
                                     <span class="s">&quot;station &#39;</span><span class="si">%s</span><span class="s">&#39; and event &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                         <span class="n">station_id</span><span class="p">,</span> <span class="n">event_name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="QueryComponent.get_stations_for_all_events"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.get_stations_for_all_events">[docs]</a>    <span class="k">def</span> <span class="nf">get_stations_for_all_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary with a list of stations per event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_stations_for_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">LASIFNotFoundError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">events</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">return</span> <span class="n">events</span>
</div>
<div class="viewcode-block" id="QueryComponent.get_iteration_status"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.get_iteration_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_iteration_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the status of an iteration. This is a query command as it</span>
<span class="sd">        integrates a lot of different information.</span>

<span class="sd">        :param iteration: The iteration which to query.</span>
<span class="sd">        :param events: If given, only the events of those events will be</span>
<span class="sd">            queried. Otherwise all will be queried.</span>

<span class="sd">        Returns a dictionary of events, each containing the following keys:</span>
<span class="sd">        ``&quot;missing_raw&quot;``, ``&quot;missing_processed&quot;``,</span>
<span class="sd">        ``&quot;missing_synthetic&quot;``, ``&quot;fraction_of_stations_that_have_windows&quot;``</span>

<span class="sd">        Each of those is a list of stations missing for that particular data</span>
<span class="sd">        type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">iterations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>

        <span class="c"># Collect the status information per event.</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

        <span class="c"># Make sure events is a list of event names to ease the later check.</span>
        <span class="k">if</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">events</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_i</span><span class="p">)[</span><span class="s">&quot;event_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">events</span><span class="p">]</span>

        <span class="c"># Get all the data.</span>
        <span class="k">for</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">event_dict</span> <span class="ow">in</span> <span class="n">iteration</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c"># Skip events if some are specified.</span>
            <span class="k">if</span> <span class="n">events</span> <span class="ow">and</span> <span class="n">event_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c"># Get all stations that should be defined for the current</span>
            <span class="c"># iteration.</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">event_dict</span><span class="p">[</span><span class="s">&quot;stations&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="c"># Raw data.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_raw</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>
                <span class="c"># Get a list of all stations</span>
                <span class="n">raw</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span>
                    <span class="s">&quot;{network}.{station}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">))</span>
                <span class="c"># Get the missing raw stations.</span>
                <span class="n">missing_raw</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">LASIFNotFoundError</span><span class="p">:</span>
                <span class="n">missing_raw</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stations</span><span class="p">)</span>
            <span class="n">status</span><span class="p">[</span><span class="n">event_name</span><span class="p">][</span><span class="s">&quot;missing_raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing_raw</span>

            <span class="c"># Processed data.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">processed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_processed</span><span class="p">(</span>
                    <span class="n">event_name</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">processing_tag</span><span class="p">)</span>
                <span class="c"># Get a list of all stations</span>
                <span class="n">processed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span>
                    <span class="s">&quot;{network}.{station}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">processed</span><span class="p">))</span>
                <span class="c"># Get all stations in raw that are also defined for the</span>
                <span class="c"># current iteration.</span>
                <span class="c"># Get the missing raw stations.</span>
                <span class="n">missing_processed</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">LASIFNotFoundError</span><span class="p">:</span>
                <span class="n">missing_processed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stations</span><span class="p">)</span>
            <span class="n">status</span><span class="p">[</span><span class="n">event_name</span><span class="p">][</span><span class="s">&quot;missing_processed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing_processed</span>

            <span class="c"># Synthetic data.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">synthetic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_synthetic</span><span class="p">(</span>
                    <span class="n">event_name</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
                <span class="c"># Get a list of all stations</span>
                <span class="n">synthetic</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span>
                    <span class="s">&quot;{network}.{station}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">synthetic</span><span class="p">))</span>
                <span class="c"># Get all stations in raw that are also defined for the</span>
                <span class="c"># current iteration.</span>
                <span class="n">missing_synthetic</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">synthetic</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">LASIFNotFoundError</span><span class="p">:</span>
                <span class="n">missing_synthetic</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stations</span><span class="p">)</span>
            <span class="n">status</span><span class="p">[</span><span class="n">event_name</span><span class="p">][</span><span class="s">&quot;missing_synthetic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing_synthetic</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">windows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">windows</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event_name</span><span class="p">,</span> <span class="n">iteration</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">LASIFNotFoundError</span><span class="p">:</span>
                <span class="n">windows</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">windows</span><span class="p">:</span>
                <span class="c"># Get the windows per station.</span>
                <span class="n">windows</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span>
                              <span class="n">windows</span><span class="o">.</span><span class="n">list</span><span class="p">())</span>
                <span class="n">windows</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">windows</span><span class="p">)</span>
            <span class="n">status</span><span class="p">[</span><span class="n">event_name</span><span class="p">][</span><span class="s">&quot;fraction_of_stations_that_have_windows&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">windows</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="QueryComponent.get_data_and_synthetics_iterator"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.get_data_and_synthetics_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">get_data_and_synthetics_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the processed data and matching synthetics for a particular event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">..tools.data_synthetics_iterator</span> <span class="kn">import</span> <span class="n">DataSyntheticIterator</span>
        <span class="k">return</span> <span class="n">DataSyntheticIterator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">get_matching_waveforms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">station_or_channel_id</span><span class="p">):</span>
        <span class="n">seed_id</span> <span class="o">=</span> <span class="n">station_or_channel_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">station_id</span> <span class="o">=</span> <span class="n">station_or_channel_id</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">seed_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">network</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">seed_id</span>
            <span class="n">station_id</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">network</span><span class="p">,</span> <span class="n">station</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;&#39;station_or_channel_id&#39; must either have &quot;</span>
                             <span class="s">&quot;2 or 4 parts.&quot;</span><span class="p">)</span>

        <span class="n">iteration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">iterations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">iteration</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c"># Get the metadata for the processed and synthetics for this</span>
        <span class="c"># particular station.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_waveforms_processed</span><span class="p">(</span>
            <span class="n">event</span><span class="p">[</span><span class="s">&quot;event_name&quot;</span><span class="p">],</span> <span class="n">station_id</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">iteration</span><span class="o">.</span><span class="n">processing_tag</span><span class="p">)</span>
        <span class="n">synthetics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_waveforms_synthetic</span><span class="p">(</span>
            <span class="n">event</span><span class="p">[</span><span class="s">&quot;event_name&quot;</span><span class="p">],</span> <span class="n">station_id</span><span class="p">,</span>
            <span class="n">long_iteration_name</span><span class="o">=</span><span class="n">iteration</span><span class="o">.</span><span class="n">long_name</span><span class="p">)</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_coordinates_for_station</span><span class="p">(</span>
            <span class="n">event</span><span class="p">[</span><span class="s">&quot;event_name&quot;</span><span class="p">],</span> <span class="n">station_id</span><span class="p">)</span>

        <span class="c"># Make sure all data has the corresponding synthetics. It should not</span>
        <span class="c"># happen that one has three channels of data but only two channels</span>
        <span class="c"># of synthetics...in that case, discard the additional data and</span>
        <span class="c"># raise a warning.</span>
        <span class="n">temp_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">data_tr</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">component</span> <span class="o">=</span> <span class="n">data_tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">synthetic_tr</span> <span class="o">=</span> <span class="p">[</span><span class="n">tr</span> <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">synthetics</span>
                            <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">component</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">synthetic_tr</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s">&quot;Station &#39;</span><span class="si">%s</span><span class="s">&#39; has observed data for component &#39;</span><span class="si">%s</span><span class="s">&#39; but no &quot;</span>
                    <span class="s">&quot;matching synthetics.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">station_id</span><span class="p">,</span> <span class="n">component</span><span class="p">),</span>
                    <span class="n">LASIFWarning</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">temp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_tr</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">traces</span> <span class="o">=</span> <span class="n">temp_data</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LASIFError</span><span class="p">(</span><span class="s">&quot;No data remaining for station &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span>
                             <span class="n">station_id</span><span class="p">)</span>

        <span class="c"># Scale the data if required.</span>
        <span class="k">if</span> <span class="n">iteration</span><span class="o">.</span><span class="n">scale_data_to_synthetics</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">data_tr</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">synthetic_tr</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">tr</span> <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">synthetics</span>
                    <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span>
                    <span class="n">data_tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">synthetic_tr</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span> <span class="o">/</span> \
                    <span class="n">data_tr</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ptp</span><span class="p">()</span>
                <span class="c"># Store and apply the scaling.</span>
                <span class="n">data_tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">scaling_factor</span> <span class="o">=</span> <span class="n">scaling_factor</span>
                <span class="n">data_tr</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">scaling_factor</span>

        <span class="n">data</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">synthetics</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c"># Select component if necessary.</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">and</span> <span class="n">channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Only use the last letter of the channel for the selection.</span>
            <span class="c"># Different solvers have different conventions for the location</span>
            <span class="c"># and channel codes.</span>
            <span class="n">component</span> <span class="o">=</span> <span class="n">channel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">traces</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">traces</span>
                           <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">component</span><span class="p">]</span>
            <span class="n">synthetics</span><span class="o">.</span><span class="n">traces</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">synthetics</span><span class="o">.</span><span class="n">traces</span>
                                 <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">component</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">DataTuple</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">synthetics</span><span class="o">=</span><span class="n">synthetics</span><span class="p">,</span>
                         <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">)</span>

<div class="viewcode-block" id="QueryComponent.discover_available_data"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.discover_available_data">[docs]</a>    <span class="k">def</span> <span class="nf">discover_available_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_name</span><span class="p">,</span> <span class="n">station_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Discovers the available data for one event at a certain station.</span>

<span class="sd">        Will raise a :exc:`~lasif.LASIFNotFoundError` if no raw data is</span>
<span class="sd">        found for the given event and station combination.</span>

<span class="sd">        :type event_name: str</span>
<span class="sd">        :param event_name: The name of the event.</span>
<span class="sd">        :type station_id: str</span>
<span class="sd">        :param station_id: The id of the station in question.</span>

<span class="sd">        :rtype: dict</span>
<span class="sd">        :returns: Return a dictionary with &quot;processed&quot; and &quot;synthetic&quot; keys.</span>
<span class="sd">            Both values will be a list of strings. In the case of &quot;processed&quot;</span>
<span class="sd">            it will be a list of all available preprocessing tags. In the case</span>
<span class="sd">            of the synthetics it will be a list of all iterations for which</span>
<span class="sd">            synthetics are available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">has_event</span><span class="p">(</span><span class="n">event_name</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Event &#39;</span><span class="si">%s</span><span class="s">&#39; not found in project.&quot;</span> <span class="o">%</span> <span class="n">event_name</span>
            <span class="k">raise</span> <span class="n">LASIFNotFoundError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c"># Attempt to get the station coordinates. This ensures availability</span>
        <span class="c"># of the raw data.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_coordinates_for_station</span><span class="p">(</span><span class="n">event_name</span><span class="p">,</span> <span class="n">station_id</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_components</span><span class="p">(</span><span class="n">waveform_cache</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">_i</span><span class="p">[</span><span class="s">&quot;channel&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">waveform_cache</span><span class="p">],</span>
                          <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_raw_for_station</span><span class="p">(</span><span class="n">event_name</span><span class="p">,</span>
                                                               <span class="n">station_id</span><span class="p">)</span>
        <span class="n">raw_comps</span> <span class="o">=</span> <span class="n">get_components</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>

        <span class="c"># Collect all tags and iteration names.</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;raw&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;raw&quot;</span><span class="p">:</span> <span class="n">raw_comps</span><span class="p">},</span>
            <span class="s">&quot;processed&quot;</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s">&quot;synthetic&quot;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="c"># Get the available synthetic and processing tags.</span>
        <span class="n">proc_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_available_processing_tags</span><span class="p">(</span>
            <span class="n">event_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">proc_tags</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">procs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_processed_for_station</span><span class="p">(</span>
                    <span class="n">event_name</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">station_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">LASIFNotFoundError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">comps</span> <span class="o">=</span> <span class="n">get_components</span><span class="p">(</span><span class="n">procs</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">comps</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">all_files</span><span class="p">[</span><span class="s">&quot;processed&quot;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">comps</span>

        <span class="n">iterations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_available_synthetics</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>
        <span class="n">synthetic_coordinates_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;X&quot;</span><span class="p">:</span> <span class="s">&quot;N&quot;</span><span class="p">,</span>
                                         <span class="s">&quot;Y&quot;</span><span class="p">:</span> <span class="s">&quot;E&quot;</span><span class="p">,</span>
                                         <span class="s">&quot;Z&quot;</span><span class="p">:</span> <span class="s">&quot;Z&quot;</span><span class="p">,</span>
                                         <span class="s">&quot;N&quot;</span><span class="p">:</span> <span class="s">&quot;N&quot;</span><span class="p">,</span>
                                         <span class="s">&quot;E&quot;</span><span class="p">:</span> <span class="s">&quot;E&quot;</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">iterations</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">its</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_synthetic_for_station</span><span class="p">(</span>
                    <span class="n">event_name</span><span class="p">,</span> <span class="n">it</span><span class="p">,</span> <span class="n">station_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">LASIFNotFoundError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">comps</span> <span class="o">=</span> <span class="n">get_components</span><span class="p">(</span><span class="n">its</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">comps</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">comps</span> <span class="o">=</span> <span class="p">[</span><span class="n">synthetic_coordinates_mapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">comps</span><span class="p">]</span>
            <span class="n">all_files</span><span class="p">[</span><span class="s">&quot;synthetic&quot;</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">comps</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_files</span>
</div>
<div class="viewcode-block" id="QueryComponent.point_in_domain"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.point_in_domain">[docs]</a>    <span class="k">def</span> <span class="nf">point_in_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests if the point is in the domain. Returns True/False</span>

<span class="sd">        :param latitude: The latitude of the point.</span>
<span class="sd">        :param longitude: The longitude of the point.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">domain</span>
        <span class="k">return</span> <span class="n">domain</span><span class="o">.</span><span class="n">point_in_domain</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">longitude</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">latitude</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="QueryComponent.what_is"><a class="viewcode-back" href="../../../components/query.html#lasif.components.query.QueryComponent.what_is">[docs]</a>    <span class="k">def</span> <span class="nf">what_is</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Debug function returning a string with information about the file.</span>
<span class="sd">        Useful as a debug function and to figure out what LASIF is doing.</span>

<span class="sd">        :param path: The path to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="c"># File does not exist.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">LASIFNotFoundError</span><span class="p">(</span><span class="s">&quot;Path &#39;</span><span class="si">%s</span><span class="s">&#39; does not exist.&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="c"># File not part of the project.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s">&quot;root&quot;</span><span class="p">]])</span> \
                <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">paths</span><span class="p">[</span><span class="s">&quot;root&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">LASIFError</span><span class="p">(</span><span class="s">&quot;File &#39;</span><span class="si">%s</span><span class="s">&#39; is not part of the LASIF project.&quot;</span> <span class="o">%</span>
                             <span class="n">path</span><span class="p">)</span>

        <span class="c"># Split in dir an folder to ease the rest.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__what_is_this_folder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__what_is_this_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__what_is_this_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="n">_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span>
               <span class="n">folder_path</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;kernels&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing all kernels and gradients.&quot;</span><span class="p">,</span>
                <span class="s">&quot;synthetics&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing synthetic waveforms.&quot;</span><span class="p">,</span>
                <span class="s">&quot;config_file&quot;</span><span class="p">:</span> <span class="s">&quot;The configuration file.&quot;</span><span class="p">,</span>
                <span class="s">&quot;logs&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing logs of various operations.&quot;</span><span class="p">,</span>
                <span class="s">&quot;config_file_cache&quot;</span><span class="p">:</span> <span class="s">&quot;The cache file for the config file.&quot;</span><span class="p">,</span>
                <span class="s">&quot;stations&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing all station files.&quot;</span><span class="p">,</span>
                <span class="s">&quot;models&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing Earth models.&quot;</span><span class="p">,</span>
                <span class="s">&quot;root&quot;</span><span class="p">:</span> <span class="s">&quot;The root directory of the project.&quot;</span><span class="p">,</span>
                <span class="s">&quot;resp&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing station files in the resp format.&quot;</span><span class="p">,</span>
                <span class="s">&quot;cache&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing various intermediate caches.&quot;</span><span class="p">,</span>
                <span class="s">&quot;inv_db_file&quot;</span><span class="p">:</span> <span class="s">&quot;Database for coordinates from the internet.&quot;</span><span class="p">,</span>
                <span class="s">&quot;station_xml&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing StationXML station files.&quot;</span><span class="p">,</span>
                <span class="s">&quot;adjoint_sources&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing adjoint sources.&quot;</span><span class="p">,</span>
                <span class="s">&quot;windows&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing window definition files.&quot;</span><span class="p">,</span>
                <span class="s">&quot;wavefields&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing wavefields.&quot;</span><span class="p">,</span>
                <span class="s">&quot;dataless_seed&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing dataless SEED station files.&quot;</span><span class="p">,</span>
                <span class="s">&quot;iterations&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing the iteration definitions.&quot;</span><span class="p">,</span>
                <span class="s">&quot;output&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing the output of various operations.&quot;</span><span class="p">,</span>
                <span class="s">&quot;data&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing raw and processed waveforms.&quot;</span><span class="p">,</span>
                <span class="s">&quot;events&quot;</span><span class="p">:</span> <span class="s">&quot;Folder storing event definitions as QuakeML.&quot;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                <span class="n">ret_str</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret_str</span> <span class="o">=</span> <span class="s">&quot;Project folder &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span> <span class="n">key</span>
            <span class="k">return</span> <span class="n">ret_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__what_is_this_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="n">_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span>
               <span class="n">file_path</span><span class="p">]</span>
        <span class="c"># Deal with files defined by the project itsself.</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&quot;config_file&quot;</span><span class="p">:</span> <span class="s">&quot;The main project configuration file.&quot;</span><span class="p">,</span>
                <span class="s">&quot;config_file_cache&quot;</span><span class="p">:</span> <span class="s">&quot;The cache file for the config file.&quot;</span><span class="p">,</span>
                <span class="s">&quot;inv_db_file&quot;</span><span class="p">:</span> <span class="s">&quot;Database for coordinates from the internet.&quot;</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
                <span class="n">ret_str</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret_str</span> <span class="o">=</span> <span class="s">&quot;Project file &#39;</span><span class="si">%s</span><span class="s">&#39;.&quot;</span> <span class="o">%</span> <span class="n">key</span>
            <span class="k">return</span> <span class="n">ret_str</span>
        <span class="c"># Deal with other files.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check if it is a subfolder of any of the other defined paths.</span>
            <span class="n">common_prefix</span> <span class="o">=</span> <span class="p">[</span><span class="n">_i</span> <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span>
                             <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="n">_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">file_path</span><span class="p">])</span> <span class="o">==</span> <span class="n">_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="c"># Not a project file if nothing is found.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">common_prefix</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="n">common_prefix</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">common_prefix</span> <span class="o">=</span> <span class="n">common_prefix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">common_prefix</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;dataless_seed&quot;</span><span class="p">,</span> <span class="s">&quot;resp&quot;</span><span class="p">,</span> <span class="s">&quot;stationxml&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__what_is_this_station_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span>
                                                        <span class="n">filetype</span><span class="o">=</span><span class="n">common_prefix</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">common_prefix</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="s">&quot;synthetics&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__what_is_this_waveform_file</span><span class="p">(</span>
                    <span class="n">file_path</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="n">common_prefix</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__what_is_this_waveform_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">filetype</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">obspy</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">waveforms</span><span class="o">.</span><span class="n">get_metadata_for_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> | </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s"> | Lat/Lng/Ele/Dep: </span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">_i</span><span class="p">[</span><span class="s">&quot;channel_id&quot;</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">obspy</span><span class="o">.</span><span class="n">UTCDateTime</span><span class="p">(</span><span class="n">_i</span><span class="p">[</span><span class="s">&quot;starttime_timestamp&quot;</span><span class="p">])),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">obspy</span><span class="o">.</span><span class="n">UTCDateTime</span><span class="p">(</span><span class="n">_i</span><span class="p">[</span><span class="s">&quot;endtime_timestamp&quot;</span><span class="p">])),</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;longitude&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;longitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;elevation_in_m&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;elevation_in_m&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;local_depth_in_m&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;local_depth_in_m&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="s">&quot;The </span><span class="si">%s</span><span class="s"> file contains information about </span><span class="si">%i</span><span class="s"> channel</span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">st</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">_format</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">),</span>
                <span class="s">&quot;s&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">info</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__what_is_this_station_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">filetype</span><span class="p">):</span>
        <span class="n">ft_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;dataless_seed&quot;</span><span class="p">:</span> <span class="s">&quot;SEED&quot;</span><span class="p">,</span> <span class="s">&quot;resp&quot;</span><span class="p">:</span> <span class="s">&quot;RESP&quot;</span><span class="p">,</span> <span class="s">&quot;stationxml&quot;</span><span class="p">:</span> <span class="s">&quot;StationXML&quot;</span>
        <span class="p">}</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">get_details_for_filename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LASIFNotFoundError</span><span class="p">(</span><span class="s">&quot;File &#39;</span><span class="si">%s</span><span class="s">&#39; is not valid station file.&quot;</span> <span class="o">%</span>
                                     <span class="n">file_path</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s"> | </span><span class="si">%s</span><span class="s"> - </span><span class="si">%s</span><span class="s"> | Lat/Lng/Ele/Dep: </span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">_i</span><span class="p">[</span><span class="s">&quot;channel_id&quot;</span><span class="p">],</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">_i</span><span class="p">[</span><span class="s">&quot;start_date&quot;</span><span class="p">]),</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">_i</span><span class="p">[</span><span class="s">&quot;end_date&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;end_date&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;latitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;longitude&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;longitude&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;elevation_in_m&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;elevation_in_m&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;local_depth_in_m&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_i</span><span class="p">[</span><span class="s">&quot;local_depth_in_m&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;--&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="n">info</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="s">&quot;The </span><span class="si">%s</span><span class="s"> file contains information about </span><span class="si">%i</span><span class="s"> channel</span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">ft_map</span><span class="p">[</span><span class="n">filetype</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">),</span> <span class="s">&quot;s&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
                <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">info</span><span class="p">)))</span></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Lion Krischer &amp; Andreas Fichtner.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>